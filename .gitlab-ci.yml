# Copyright 2022 ETH Zurich and University of Bologna.
# Solderpad Hardware License, Version 0.51, see LICENSE for details.
# SPDX-License-Identifier: SHL-0.51

# Author: Thomas Benz <tbenz@iis.ee.ethz.ch>

variables:
  SPHINXBUILD: "/home/tbenz/.local/bin/sphinx-build"
  MORTY: "/home/tbenz/.cargo/bin/morty"

before_script:
  - source ~paulsc/.bashrc

stages:
  - prepare-non-free
  - iDMA

############# Below: only works on IIS machines ####################

prepare-non-free:
  stage: prepare-non-free
  script:
    - git clone git@iis-git.ee.ethz.ch:bslk/idma/idma-non-free.git
    - cd idma-non-free
    - git checkout tsenti
    - make -B gen_sub_ci
  artifacts:
      paths:
        - idma-non-free/ci/*.yml


# Below: Automatically generated by util/gen_ci.py

axi_backend_combined_shifter-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_backend_combined_shifter-ci.yml
        job: prepare-non-free
    strategy: depend

axi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

obi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-obi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_to_obi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_to_obi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

obi_to_axi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-obi_to_axi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_obi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_obi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_lite_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_lite_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_axi_lite_axi_stream_obi_init_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_axi_lite_axi_stream_obi_init_backend-ci.yml
        job: prepare-non-free
    strategy: depend

tilelink_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-tilelink_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_to_tilelink_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_to_tilelink_backend-ci.yml
        job: prepare-non-free
    strategy: depend

tilelink_to_axi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-tilelink_to_axi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_init_to_axi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_init_to_axi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_stream_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_stream_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_to_axi_stream_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_to_axi_stream_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_stream_to_axi_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_stream_to_axi_backend-ci.yml
        job: prepare-non-free
    strategy: depend

axi_axi_stream_backend-run:
  stage: iDMA
  needs:
    - prepare-non-free
  trigger:
    include:
      - artifact: idma-non-free/ci/gitlab-axi_axi_stream_backend-ci.yml
        job: prepare-non-free
    strategy: depend

